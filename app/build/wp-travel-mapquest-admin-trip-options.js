(()=>{"use strict";(()=>{const e=window.wp.element,t=window.wp.hooks,a=window.wp.data,l=window.wp.i18n;class n extends e.Component{constructor(e){super(e),this.state={hasError:!1,error:null,errorInfo:null}}static getDerivedStateFromError(e){return{hasError:!0}}componentDidCatch(e,t){this.setState({error:e,errorInfo:t})}render(){return this.state.hasError?(0,e.createElement)("div",null,(0,e.createElement)("h2",null,"Something went wrong."),(0,e.createElement)("details",{style:{whiteSpace:"pre-wrap"}},this.state.error&&this.state.error.toString(),(0,e.createElement)("br",null),this.state.errorInfo&&this.state.errorInfo.componentStack)):this.props.children}}const r=window.lodash,o=window.wp.components;let s,i,c,p=[];const m=t=>{const{apiKey:a,zoomlevel:n,latlng:r,onLatLngChange:o,clientId:m,isBlock:u}=t;return(0,e.useEffect)((()=>{s&&s.setView(r),i=L.marker(r),s&&i.addTo(s)}),[r]),(0,e.useEffect)((()=>(s||(L.mapquest.key=a,s=L.mapquest.map("wpTravelMap-"+m,{center:Object.values(r),layers:L.mapquest.tileLayer("map"),zoom:n}),s.setView(r),i=L.marker(r),i.addTo(s),L.mapquest.control().addTo(s),(e=>{var t=e.selector,a=e.apiKey,l=e.latlng,n=e.zoom,r=e.onLatLngChange;if(!t.length)return;const o=e=>s.removeLayer(e),m=e=>{let t=L.marker(e.latlng,{opacity:.4});t.addTo(s),p.push(t)};c=placeSearch({key:a,container:document.querySelector(t),useDeviceLocation:!0,collection:["poi","airport","address","adminArea"]}),c.on("change",(e=>{let t=e.result.name;p.forEach((function(a,l){l===e.resultIndex?(p=[a],a.setOpacity(1),s.setView(e.result.latlng,n),r(e.result.latlng,t)):o(a)}))})),c.on("results",(e=>{p.forEach(o),p=[],0!==e.results.length?(e.results.forEach(m),(()=>{let e=L.featureGroup(p);s.fitBounds(e.getBounds().pad(.5),{animate:!1})})()):s.setView(new L.LatLng(0,0),2)})),c.on("cursorchanged",(e=>{p.forEach((function(t,a){a===e.resultIndex?(t.setOpacity(1),t.setZIndexOffset(1e3)):(t.setZIndexOffset(0),t.setOpacity(.5))}))})),c.on("clear",(function(){s.setView(l,2),o.apply(p),o(i),m({latlng:l})})),c.on("error",(function(e){console.log(e)}))})({selector:"#wpTravelMapSearch-"+m,apiKey:a,latlng:r,zoom:n,onLatLngChange:o})),()=>{s=null})),[]),(0,e.createElement)("div",{className:"wp-travel-map"},(0,e.createElement)("div",{className:"wp-travel-map__container"},(0,e.createElement)("div",{id:`wpTravelMap-${m}`,style:{height:500,width:"100%"}}),(0,e.createElement)("div",{className:"wp-travel-map__search"},(0,e.createElement)("input",{id:`wpTravelMapSearch-${m}`,type:"search",placeholder:(0,l.__)("Start Searching...")}))))},u=t=>{let{settingsData:r,map_data:s,isBlock:i,clientId:c}=t;if(!r||!s)return(0,e.createElement)(e.Fragment,null);const{map_quest_api_key:p,wp_travel_map:u}=r;if("wp-travel-mapquest"!==u)return(0,e.createElement)(e.Fragment,null);if(!p)return[...content,(0,e.createElement)(e.Fragment,null,(0,e.createElement)(o.Notice,{status:"warning",isDismissible:!1},(0,e.createElement)("strong",{dangerouslySetInnerHTML:{__html:sprintf((0,l.__)("Please add <code>Consumer Key/API KEY</code> and <code>APP_CODE</code>' in the %ssettings%s to use Mapquest map or you can select other service from available map options."),'<a href="edit.php?post_type=itinerary-booking&page=settings">',"</a>")}})),(0,e.createElement)("br",null))];const[d,g]=(0,e.useState)(!1),_=(0,a.useSelect)((e=>e("WPTravel/TripEdit").getAllStore())),{lat:h,lng:E}=s,{updateTripData:w}=(0,a.dispatch)("WPTravel/TripEdit"),v=r&&r.map_quest_api_key||"",y=r&&r.wpt_here_map_zoom_level||8,f=e=>t=>{w({..._,map_data:{..._.map_data,[e]:t}})};return console.log(c),(0,e.createElement)(e.Fragment,null,(0,e.createElement)("div",{className:"wp-travel-here-map"},(0,e.createElement)(o.PanelRow,null,(0,e.createElement)("label",null,(0,l.__)("Show Co-ordinates")),(0,e.createElement)(o.ToggleControl,{help:(0,l.__)("Show co-ordinate of active marker."),checked:d,onChange:()=>g(!d)})),d&&(0,e.createElement)("div",{className:"wp-travel-here-map__input"},(0,e.createElement)(o.PanelRow,null,(0,e.createElement)("label",null,(0,l.__)("Latitude")),(0,e.createElement)(o.TextControl,{value:h,type:"number",step:"0.000001",onChange:f("lat")})),(0,e.createElement)(o.PanelRow,null,(0,e.createElement)("label",null,(0,l.__)("Longitude")),(0,e.createElement)(o.TextControl,{value:E,type:"number",step:"0.000001",onChange:f("lng")}))),(0,e.createElement)(n,null,(0,e.createElement)(o.PanelRow,null,(0,e.createElement)("div",{className:"wp-travel-map-wrap wp-travel-map-wrap__mapquest-map",style:{width:"100%",border:"1px solid #11a0d2"}},(0,e.createElement)(m,{latlng:{lat:h,lng:E},apiKey:v,onChange:f,zoomlevel:y,onLatLngChange:(e,t)=>{const{lat:a,lng:l}=e;w({..._,map_data:{..._.map_data,lat:a,lng:l,loc:t}})},clientId:c,isBlock:i}))))))},d=t=>{let{location:a,changeLocation:n,settings:s,clientId:i}=t;if(!s)return(0,e.createElement)(e.Fragment,null);const{wp_travel_map:c}=s;if("wp-travel-mapquest"!==c)return(0,e.createElement)(e.Fragment,null);const[p,m]=(0,e.useState)(u),u=(0,r.has)(a,"loc")&&!(0,r.isEmpty)(a.loc)?a.loc:"",d=(s&&s.map_quest_api_key,(0,r.has)(a,"lat")&&!(0,r.isEmpty)(a.lat)?a.lat:""),g=(0,r.has)(a,"lng")&&!(0,r.isEmpty)(a.lng)?a.lng:"",_=(a.wpt_here_map_zoom_level,!(!(0,r.has)(a,"use_lat_lng")||(0,r.isEmpty)(a.use_lat_lng)||"no"===a.use_lat_lng)&&a.use_lat_lng);return(0,e.createElement)(e.Fragment,null,(0,e.createElement)(o.PanelBody,{title:(0,l.__)("Map Settings")},(0,e.createElement)(o.Notice,{status:"warning",isDismissible:!1},(0,e.createElement)("strong",null,"Note:")," Making changes on following setting will also change trip location."),(0,e.createElement)("hr",null),(0,e.createElement)(o.ToggleControl,{label:(0,l.__)("Enable Latitude/ Longitude"),checked:_,onChange:e=>{n({use_lat_lng:e?"yes":"no"})}}),!_&&(0,e.createElement)(e.Fragment,null),_&&(0,e.createElement)("div",null,(0,e.createElement)(o.TextControl,{label:(0,l.__)("Latitude"),value:d,onChange:e=>{n({lat:e})}}),(0,e.createElement)(o.TextControl,{label:(0,l.__)("Longitude"),value:g,onChange:e=>{n({lng:e})}}))))};(0,t.addFilter)("wp_travel_admin_map_area","WPTravel/TripEdit/Locations/Mapquest",((t,a,l)=>[...t,(0,e.createElement)(u,{settingsData:a,map_data:l,key:"MapquestMap",isBlock:!1,clientId:"metabox"})]),15),(0,t.addFilter)("wptravel_trip_edit_block_map_area","WPTravel/TripEdit/Block/Locations/MapquestBlockControls",((t,a,l,n)=>[...t,(0,e.createElement)(d,n)]),20),(0,t.addFilter)("wptravel_trip_edit_block_map_area_view","WPTravel/TripEdit/Block/Locations/Mapquest",((t,a,l,n)=>[...t,(0,e.createElement)(u,{settingsData:a,map_data:l,key:"MapquestMap",isBlock:!0,clientId:n.clientId})]))})()})();